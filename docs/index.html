<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Sapo Client SDK - v0.3.3</title><meta name="description" content="Documentation for Sapo Client SDK"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"><a href="https://github.com/yourusername/sapo-client-sdk">GitHub</a></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Sapo Client SDK - v0.3.3</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>Sapo Client SDK - v0.3.3</h2></div><div class="tsd-panel tsd-typography"><a id="md:sapo-client-sdk" class="tsd-anchor"></a><h1><a href="#md:sapo-client-sdk">Sapo Client SDK</a></h1><p>Một SDK viết bằng TypeScript dành cho API của Sapo, cung cấp các phương thức tiện lợi để xác thực và thao tác với API.</p>
<a id="md:tính-năng-nổi-bật" class="tsd-anchor"></a><h2><a href="#md:tính-năng-nổi-bật">Tính năng nổi bật</a></h2><ul>
<li>Hỗ trợ đầy đủ TypeScript với định nghĩa kiểu rõ ràng</li>
<li>Hỗ trợ xác thực theo chuẩn OAuth 2.0</li>
<li>Tự động giới hạn tốc độ gọi API (40 yêu cầu/phút, 80.000 yêu cầu/ngày)</li>
<li>Các module API theo từng loại tài nguyên</li>
<li>Xử lý lỗi với các class lỗi được định nghĩa sẵn</li>
<li>Hỗ trợ interceptor cho request/response</li>
<li>Tiện ích xử lý webhook</li>
</ul>
<a id="md:cài-đặt" class="tsd-anchor"></a><h2><a href="#md:cài-đặt">Cài đặt</a></h2><pre><code class="language-bash"><span class="hl-0"># Sử dụng npm</span><br/><span class="hl-1">npm</span><span class="hl-2"> </span><span class="hl-3">install</span><span class="hl-2"> </span><span class="hl-3">sapo-client-sdk</span><br/><br/><span class="hl-0"># Sử dụng yarn</span><br/><span class="hl-1">yarn</span><span class="hl-2"> </span><span class="hl-3">add</span><span class="hl-2"> </span><span class="hl-3">sapo-client-sdk</span><br/><br/><span class="hl-0"># Sử dụng pnpm</span><br/><span class="hl-1">pnpm</span><span class="hl-2"> </span><span class="hl-3">add</span><span class="hl-2"> </span><span class="hl-3">sapo-client-sdk</span>
</code><button>Copy</button></pre>
<a id="md:yêu-cầu-hệ-thống" class="tsd-anchor"></a><h3><a href="#md:yêu-cầu-hệ-thống">Yêu cầu hệ thống</a></h3><ul>
<li>Node.js phiên bản 14.x trở lên</li>
<li>TypeScript phiên bản 4.x trở lên (nếu bạn dùng TypeScript)</li>
</ul>
<a id="md:cấu-hình" class="tsd-anchor"></a><h3><a href="#md:cấu-hình">Cấu hình</a></h3><p>Tạo file <code>.env</code> ở thư mục gốc của dự án:</p>
<pre><code class="language-env">SAPO_API_KEY=your_api_key
SAPO_SECRET_KEY=your_secret_key
SAPO_REDIRECT_URI=https://your-app.com/oauth/callback
</code><button>Copy</button></pre>
<a id="md:khởi-động-nhanh" class="tsd-anchor"></a><h2><a href="#md:khởi-động-nhanh">Khởi động nhanh</a></h2><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-2"> { </span><span class="hl-5">SapoClient</span><span class="hl-2"> } </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;sapo-client-sdk&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Khởi tạo client</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-6">new</span><span class="hl-2"> </span><span class="hl-1">SapoClient</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-3">&#39;private&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">store:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">apiKey:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-api-key&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">apiSecret:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-secret-key&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Lấy URL để người dùng xác thực OAuth</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">authUrl</span><span class="hl-2"> = </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">getAuthorizationUrl</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">store:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">scopes:</span><span class="hl-2"> [</span><span class="hl-3">&#39;read_products&#39;</span><span class="hl-2">, </span><span class="hl-3">&#39;write_products&#39;</span><span class="hl-2">],</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Sau khi xác thực, hoàn tất quy trình OAuth</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">token</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">completeOAuth</span><span class="hl-2">(</span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">, </span><span class="hl-3">&#39;callback-url-with-code&#39;</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Gọi API</span><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">products</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-3">&#39;/admin/products.json&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-5">products</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&#39;Lỗi API:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:hướng-dẫn-xác-thực" class="tsd-anchor"></a><h2><a href="#md:hướng-dẫn-xác-thực">Hướng dẫn xác thực</a></h2><p>SDK hỗ trợ quy trình xác thực theo chuẩn OAuth 2.0. Các bước triển khai như sau:</p>
<a id="md:1-khởi-tạo-client" class="tsd-anchor"></a><h3><a href="#md:1-khởi-tạo-client">1. Khởi tạo client</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-6">new</span><span class="hl-2"> </span><span class="hl-1">SapoClient</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-3">&#39;private&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">store:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">apiKey:</span><span class="hl-2"> </span><span class="hl-5">process</span><span class="hl-2">.</span><span class="hl-5">env</span><span class="hl-2">.</span><span class="hl-7">SAPO_API_KEY</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">apiSecret:</span><span class="hl-2"> </span><span class="hl-5">process</span><span class="hl-2">.</span><span class="hl-5">env</span><span class="hl-2">.</span><span class="hl-7">SAPO_SECRET_KEY</span><span class="hl-2">,</span><br/><span class="hl-2">});</span>
</code><button>Copy</button></pre>
<a id="md:2-tạo-url-xác-thực" class="tsd-anchor"></a><h3><a href="#md:2-tạo-url-xác-thực">2. Tạo URL xác thực</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">authUrl</span><span class="hl-2"> = </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">getAuthorizationUrl</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">store:</span><span class="hl-2"> </span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">scopes:</span><span class="hl-2"> [</span><span class="hl-3">&#39;read_products&#39;</span><span class="hl-2">, </span><span class="hl-3">&#39;write_products&#39;</span><span class="hl-2">],</span><br/><span class="hl-2">  </span><span class="hl-5">state:</span><span class="hl-2"> </span><span class="hl-3">&#39;optional-state-parameter&#39;</span><span class="hl-2">, </span><span class="hl-0">// Tùy chọn để bảo vệ CSRF</span><br/><span class="hl-2">});</span><br/><span class="hl-0">// Chuyển hướng người dùng tới authUrl</span>
</code><button>Copy</button></pre>
<a id="md:3-xử-lý-callback-từ-oauth" class="tsd-anchor"></a><h3><a href="#md:3-xử-lý-callback-từ-oauth">3. Xử lý callback từ OAuth</a></h3><pre><code class="language-typescript"><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-3">&#39;/oauth/callback&#39;</span><span class="hl-2">, </span><span class="hl-6">async</span><span class="hl-2"> (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-6">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">token</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">completeOAuth</span><span class="hl-2">(</span><br/><span class="hl-2">      </span><span class="hl-3">&#39;your-store.mysapo.net&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">      </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">url</span><span class="hl-2"> </span><span class="hl-0">// URL callback chứa mã xác thực</span><br/><span class="hl-2">    );</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// Lưu token một cách an toàn</span><br/><span class="hl-2">    </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-1">saveToken</span><span class="hl-2">(</span><span class="hl-5">token</span><span class="hl-2">);</span><br/><br/><span class="hl-2">    </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-1">redirect</span><span class="hl-2">(</span><span class="hl-3">&#39;/dashboard&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">error</span><span class="hl-2">(</span><span class="hl-3">&#39;Lỗi OAuth:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-1">redirect</span><span class="hl-2">(</span><span class="hl-3">&#39;/error&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">});</span>
</code><button>Copy</button></pre>
<a id="md:4-quản-lý-token" class="tsd-anchor"></a><h3><a href="#md:4-quản-lý-token">4. Quản lý token</a></h3><pre><code class="language-typescript"><span class="hl-0">// Lưu token</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">token</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">completeOAuth</span><span class="hl-2">(...);</span><br/><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">setToken</span><span class="hl-2">(</span><span class="hl-5">token</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Kiểm tra token hết hạn</span><br/><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">isTokenExpired</span><span class="hl-2">()) {</span><br/><span class="hl-2">  </span><span class="hl-0">// Làm mới token</span><br/><span class="hl-2">  </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">newToken</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">refreshToken</span><span class="hl-2">(</span><span class="hl-5">token</span><span class="hl-2">.</span><span class="hl-5">refresh_token</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">setToken</span><span class="hl-2">(</span><span class="hl-5">newToken</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:giới-hạn-tốc-độ-rate-limiting" class="tsd-anchor"></a><h2><a href="#md:giới-hạn-tốc-độ-rate-limiting">Giới hạn tốc độ (Rate Limiting)</a></h2><p>SDK sử dụng thuật toán token bucket để giới hạn tốc độ theo yêu cầu của Sapo:</p>
<ul>
<li>40 yêu cầu/phút/IP</li>
<li>80.000 yêu cầu/ngày/shop</li>
</ul>
<a id="md:giới-hạn-tự-động" class="tsd-anchor"></a><h3><a href="#md:giới-hạn-tự-động">Giới hạn tự động</a></h3><p>SDK sẽ tự động quản lý việc giới hạn tốc độ và xếp hàng các yêu cầu nếu cần:</p>
<pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2"> = </span><span class="hl-6">new</span><span class="hl-2"> </span><span class="hl-1">SapoClient</span><span class="hl-2">({...});</span><br/><br/><span class="hl-4">for</span><span class="hl-2"> (</span><span class="hl-6">let</span><span class="hl-2"> </span><span class="hl-5">i</span><span class="hl-2"> = </span><span class="hl-8">0</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2"> &lt; </span><span class="hl-8">100</span><span class="hl-2">; </span><span class="hl-5">i</span><span class="hl-2">++) {</span><br/><span class="hl-2">  </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-3">&#39;/admin/products.json&#39;</span><span class="hl-2">); </span><span class="hl-0">// SDK sẽ tự xếp hàng các yêu cầu</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:kiểm-tra-thủ-công" class="tsd-anchor"></a><h3><a href="#md:kiểm-tra-thủ-công">Kiểm tra thủ công</a></h3><p>Bạn có thể tự kiểm tra trạng thái giới hạn:</p>
<pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">limits</span><span class="hl-2"> = </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">getRateLimits</span><span class="hl-2">();</span><br/><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">remaining:</span><span class="hl-2"> </span><span class="hl-5">limits</span><span class="hl-2">.</span><span class="hl-5">remaining</span><span class="hl-2">, </span><span class="hl-0">// Số yêu cầu còn lại</span><br/><span class="hl-2">  </span><span class="hl-5">limit:</span><span class="hl-2"> </span><span class="hl-5">limits</span><span class="hl-2">.</span><span class="hl-5">limit</span><span class="hl-2">, </span><span class="hl-0">// Tổng giới hạn</span><br/><span class="hl-2">  </span><span class="hl-5">reset:</span><span class="hl-2"> </span><span class="hl-5">limits</span><span class="hl-2">.</span><span class="hl-5">reset</span><span class="hl-2">, </span><span class="hl-0">// Thời gian reset tiếp theo</span><br/><span class="hl-2">});</span>
</code><button>Copy</button></pre>
<p>Xử lý lỗi do vượt quá giới hạn:</p>
<pre><code class="language-typescript"><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-3">&#39;/admin/products.json&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">RateLimitError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Vượt quá giới hạn gọi API&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Thử lại sau:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">retryAfter</span><span class="hl-2">, </span><span class="hl-3">&#39;giây&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:hướng-dẫn-xử-lý-lỗi" class="tsd-anchor"></a><h2><a href="#md:hướng-dẫn-xử-lý-lỗi">Hướng dẫn xử lý lỗi</a></h2><p>SDK cung cấp các class lỗi được định nghĩa để dễ xử lý:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-5">SapoError</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">AuthenticationError</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">RateLimitError</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">ValidationError</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">NotFoundError</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">NetworkError</span><span class="hl-2">,</span><br/><span class="hl-2">} </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;sapo-client-sdk&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-1">get</span><span class="hl-2">(</span><span class="hl-3">&#39;/admin/products.json&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">AuthenticationError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Xác thực thất bại:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">RateLimitError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Quá giới hạn, thử lại sau:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">retryAfter</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">ValidationError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Lỗi xác thực dữ liệu:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">errors</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">NotFoundError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Không tìm thấy tài nguyên:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">NetworkError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Lỗi mạng:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">);</span><br/><span class="hl-2">  } </span><span class="hl-4">else</span><span class="hl-2"> </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-5">error</span><span class="hl-2"> </span><span class="hl-6">instanceof</span><span class="hl-2"> </span><span class="hl-9">SapoError</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Lỗi từ API:&#39;</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">message</span><span class="hl-2">, </span><span class="hl-5">error</span><span class="hl-2">.</span><span class="hl-5">code</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:hướng-dẫn-xử-lý-webhook" class="tsd-anchor"></a><h2><a href="#md:hướng-dẫn-xử-lý-webhook">Hướng dẫn xử lý Webhook</a></h2><p>SDK hỗ trợ đầy đủ các thao tác với webhook:</p>
<a id="md:tạo-webhook" class="tsd-anchor"></a><h3><a href="#md:tạo-webhook">Tạo Webhook</a></h3><pre><code class="language-typescript"><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">webhooks</span><span class="hl-2"> = </span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-5">webhooks</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// Tạo webhook mới</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">webhook</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">create</span><span class="hl-2">({</span><br/><span class="hl-2">  </span><span class="hl-5">topic:</span><span class="hl-2"> </span><span class="hl-3">&#39;orders/create&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">address:</span><span class="hl-2"> </span><span class="hl-3">&#39;https://your-app.com/webhooks&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-5">format:</span><span class="hl-2"> </span><span class="hl-3">&#39;json&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">});</span><br/><br/><span class="hl-0">// Danh sách webhook đang hoạt động</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">activeWebhooks</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">list</span><span class="hl-2">();</span><br/><br/><span class="hl-0">// Cập nhật webhook</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">update</span><span class="hl-2">(</span><span class="hl-5">webhook</span><span class="hl-2">.</span><span class="hl-5">id</span><span class="hl-2">, {</span><br/><span class="hl-2">  </span><span class="hl-5">address:</span><span class="hl-2"> </span><span class="hl-3">&#39;https://new-address.com/webhooks&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">});</span>
</code><button>Copy</button></pre>
<a id="md:bảo-mật-webhook" class="tsd-anchor"></a><h3><a href="#md:bảo-mật-webhook">Bảo mật webhook</a></h3><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-2"> </span><span class="hl-5">express</span><span class="hl-2"> </span><span class="hl-4">from</span><span class="hl-2"> </span><span class="hl-3">&#39;express&#39;</span><span class="hl-2">;</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">app</span><span class="hl-2"> = </span><span class="hl-1">express</span><span class="hl-2">();</span><br/><br/><span class="hl-5">app</span><span class="hl-2">.</span><span class="hl-1">post</span><span class="hl-2">(</span><span class="hl-3">&#39;/webhooks&#39;</span><span class="hl-2">, </span><span class="hl-5">express</span><span class="hl-2">.</span><span class="hl-1">raw</span><span class="hl-2">({ </span><span class="hl-5">type:</span><span class="hl-2"> </span><span class="hl-3">&#39;application/json&#39;</span><span class="hl-2"> }), (</span><span class="hl-5">req</span><span class="hl-2">, </span><span class="hl-5">res</span><span class="hl-2">) </span><span class="hl-6">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">signature</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">headers</span><span class="hl-2">[</span><span class="hl-3">&#39;x-sapo-hmac-sha256&#39;</span><span class="hl-2">];</span><br/><span class="hl-2">  </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">body</span><span class="hl-2"> = </span><span class="hl-5">req</span><span class="hl-2">.</span><span class="hl-5">body</span><span class="hl-2">.</span><span class="hl-1">toString</span><span class="hl-2">();</span><br/><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-5">client</span><span class="hl-2">.</span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">verifySignature</span><span class="hl-2">(</span><span class="hl-5">signature</span><span class="hl-2">, </span><span class="hl-5">body</span><span class="hl-2">)) {</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2"> </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-1">status</span><span class="hl-2">(</span><span class="hl-8">401</span><span class="hl-2">).</span><span class="hl-1">send</span><span class="hl-2">(</span><span class="hl-3">&#39;Chữ ký không hợp lệ&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  }</span><br/><br/><span class="hl-2">  </span><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">webhook</span><span class="hl-2"> = </span><span class="hl-7">JSON</span><span class="hl-2">.</span><span class="hl-1">parse</span><span class="hl-2">(</span><span class="hl-5">body</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">console</span><span class="hl-2">.</span><span class="hl-1">log</span><span class="hl-2">(</span><span class="hl-3">&#39;Webhook nhận được:&#39;</span><span class="hl-2">, </span><span class="hl-5">webhook</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-5">res</span><span class="hl-2">.</span><span class="hl-1">status</span><span class="hl-2">(</span><span class="hl-8">200</span><span class="hl-2">).</span><span class="hl-1">send</span><span class="hl-2">(</span><span class="hl-3">&#39;OK&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">});</span>
</code><button>Copy</button></pre>
<a id="md:quản-lý-webhook-deliveries" class="tsd-anchor"></a><h3><a href="#md:quản-lý-webhook-deliveries">Quản lý webhook deliveries</a></h3><pre><code class="language-typescript"><span class="hl-0">// Danh sách lịch sử gửi webhook</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">deliveries</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">listDeliveries</span><span class="hl-2">(</span><span class="hl-5">webhookId</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Xem chi tiết một lần gửi</span><br/><span class="hl-6">const</span><span class="hl-2"> </span><span class="hl-7">delivery</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">getDelivery</span><span class="hl-2">(</span><span class="hl-5">webhookId</span><span class="hl-2">, </span><span class="hl-5">deliveryId</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Gửi lại nếu thất bại</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">resendDelivery</span><span class="hl-2">(</span><span class="hl-5">webhookId</span><span class="hl-2">, </span><span class="hl-5">deliveryId</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Test webhook</span><br/><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">webhooks</span><span class="hl-2">.</span><span class="hl-1">test</span><span class="hl-2">(</span><span class="hl-5">webhookId</span><span class="hl-2">);</span>
</code><button>Copy</button></pre>
<a id="md:tài-liệu-api" class="tsd-anchor"></a><h2><a href="#md:tài-liệu-api">Tài liệu API</a></h2><p>Tham khảo thêm tại:</p>
<ul>
<li><a href="docs/authentication.md">Xác thực</a></li>
<li><a href="docs/products.md">Sản phẩm</a></li>
<li><a href="docs/orders.md">Đơn hàng</a></li>
<li><a href="docs/customers.md">Khách hàng</a></li>
<li><a href="docs/collections.md">Bộ sưu tập</a></li>
<li><a href="docs/inventory.md">Kho hàng</a></li>
<li><a href="docs/price-rules.md">Quy tắc giá &amp; Giảm giá</a></li>
<li><a href="docs/fulfillments.md">Thực hiện đơn hàng</a></li>
<li><a href="docs/metafields.md">Metafields</a></li>
<li><a href="docs/pages.md">Trang</a></li>
<li><a href="docs/blogs.md">Blog &amp; Bài viết</a></li>
<li><a href="docs/webhooks.md">Webhook</a></li>
</ul>
<a id="md:giấy-phép-sử-dụng" class="tsd-anchor"></a><h2><a href="#md:giấy-phép-sử-dụng">Giấy phép sử dụng</a></h2><p>Phát hành theo giấy phép MIT – xem file LICENSE để biết thêm chi tiết.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:sapo-client-sdk"><span>Sapo <wbr/>Client SDK</span></a><ul><li><a href="#md:tính-năng-nổi-bật"><span>Tính năng nổi bật</span></a></li><li><a href="#md:cài-đặt"><span>Cài đặt</span></a></li><li><ul><li><a href="#md:yêu-cầu-hệ-thống"><span>Yêu cầu hệ thống</span></a></li><li><a href="#md:cấu-hình"><span>Cấu hình</span></a></li></ul></li><li><a href="#md:khởi-động-nhanh"><span>Khởi động nhanh</span></a></li><li><a href="#md:hướng-dẫn-xác-thực"><span>Hướng dẫn xác thực</span></a></li><li><ul><li><a href="#md:1-khởi-tạo-client"><span>1. <wbr/>Khởi tạo client</span></a></li><li><a href="#md:2-tạo-url-xác-thực"><span>2. <wbr/>Tạo URL xác thực</span></a></li><li><a href="#md:3-xử-lý-callback-từ-oauth"><span>3. <wbr/>Xử lý callback từ OAuth</span></a></li><li><a href="#md:4-quản-lý-token"><span>4. <wbr/>Quản lý token</span></a></li></ul></li><li><a href="#md:giới-hạn-tốc-độ-rate-limiting"><span>Giới hạn tốc độ (<wbr/>Rate <wbr/>Limiting)</span></a></li><li><ul><li><a href="#md:giới-hạn-tự-động"><span>Giới hạn tự động</span></a></li><li><a href="#md:kiểm-tra-thủ-công"><span>Kiểm tra thủ công</span></a></li></ul></li><li><a href="#md:hướng-dẫn-xử-lý-lỗi"><span>Hướng dẫn xử lý lỗi</span></a></li><li><a href="#md:hướng-dẫn-xử-lý-webhook"><span>Hướng dẫn xử lý <wbr/>Webhook</span></a></li><li><ul><li><a href="#md:tạo-webhook"><span>Tạo <wbr/>Webhook</span></a></li><li><a href="#md:bảo-mật-webhook"><span>Bảo mật webhook</span></a></li><li><a href="#md:quản-lý-webhook-deliveries"><span>Quản lý webhook deliveries</span></a></li></ul></li><li><a href="#md:tài-liệu-api"><span>Tài liệu API</span></a></li><li><a href="#md:giấy-phép-sử-dụng"><span>Giấy phép sử dụng</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Sapo Client SDK - v0.3.3</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>